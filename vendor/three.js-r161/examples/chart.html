<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>哈威SSR团队作品前端展示</title>
  <!-- SB Admin 2 样式 -->
  <link href="css/sb-admin-2.min.css" rel="stylesheet">
  <link href="vendor/fontawesome-free/css/all.min.css" rel="stylesheet" type="text/css">
  <link href="vendor/toastr/toastr.min.css" rel="stylesheet">

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
  <script src="vendor/toastr/toastr.min.js"></script>

  <style>
    /* Three.js 容器 */
    #threejs-container {
      width: 100%;
      height: 400px;
      margin-bottom: 1rem;
    }

    /* Chart.js 容器 */
    .chart-area canvas,
    .chart-pie canvas {
      width: 100% !important;
      height: 310px !important;
    }
  </style>

  <!-- Importmap for Three.js -->
  <script type="importmap">
  {
    "imports": {
      "three": "/build/three.module.js",
      "three/addons/": "./jsm/"
    }
  }
  </script>

  <!-- Three.js 全局变量 -->
  <script>
    var scene, camera, renderer, controls, robot;
  </script>

  <!-- Three.js + URDF + STL 脚本 -->
  <script type="module">
    import * as THREE from 'three';
    import {
      WebGLRenderer, PerspectiveCamera, Scene, Mesh,
      PlaneGeometry, ShadowMaterial, DirectionalLight,
      PCFSoftShadowMap, SRGBColorSpace, Color,
      AmbientLight, Box3, LoadingManager, MeshStandardMaterial
    } from 'three';
    import { OrbitControls } from 'three/addons/controls/OrbitControls.js';
    import URDFLoader from 'three/addons/loaders/URDFLoader.js';
    import { STLLoader } from 'three/addons/loaders/STLLoader.js';

    // 延迟初始化，确保 DOM 已就绪
    window.addEventListener('DOMContentLoaded', () => {
      initThreeJS();
      animate();
    });

    function initThreeJS() {
      // 场景
      scene = new Scene();
      scene.background = new Color(0x263238);

      // 相机
      camera = new PerspectiveCamera(45, 1, 0.1, 1000);
      camera.position.set(10,10,10);
      camera.lookAt(0,0,0);

      // 渲染器
      renderer = new WebGLRenderer({ antialias:true });
      renderer.outputColorSpace = SRGBColorSpace;
      renderer.shadowMap.enabled = true;
      renderer.shadowMap.type = PCFSoftShadowMap;
      const container = document.getElementById('threejs-container');
      container.appendChild(renderer.domElement);
      onResize();
      window.addEventListener('resize', onResize);

      // 光源
      const dirLight = new DirectionalLight(0xffffff,1);
      dirLight.castShadow = true;
      dirLight.shadow.mapSize.setScalar(1024);
      dirLight.position.set(5,30,5);
      scene.add(dirLight);
      scene.add(new AmbientLight(0xffffff,0.2));

      // 地面
      const ground = new Mesh(
        new PlaneGeometry(30,30),
        new ShadowMaterial({ opacity:0.25 })
      );
      ground.rotation.x = -Math.PI/2;
      ground.receiveShadow = true;
      scene.add(ground);

      // 控制器
      controls = new OrbitControls(camera, renderer.domElement);
      controls.minDistance = 4;
      controls.target.set(0,1,0);
      controls.update();

      // 加载 STL
      const stlLoader = new STLLoader();
      stlLoader.load('models/urdf3/cone.stl',
        geom => {
          const mat = new MeshStandardMaterial({ color:0xAAAAAA });
          const mesh = new Mesh(geom, mat);
          mesh.castShadow = mesh.receiveShadow = true;
          scene.add(mesh);
        },
        undefined,
        err => console.error('STLLoader Error:',err)
      );

      // 加载 URDF
      const manager = new LoadingManager();
      const urdfLoader = new URDFLoader(manager);
      urdfLoader.load('models/urdf3/claude.urdf',
        r => robot = r,
        undefined,
        err => console.error('URDFLoader Error:',err)
      );
      manager.onLoad = () => {
        if (!robot) return console.error('Robot model not loaded!');
        robot.rotation.x = -Math.PI/2;
        robot.traverse(c=>c.castShadow=true);
        robot.updateMatrixWorld(true);
        const bb = new Box3().setFromObject(robot);
        robot.position.y -= bb.min.y;
        scene.add(robot);
      };
    }

    function onResize() {
      const container = document.getElementById('threejs-container');
      const w = container.clientWidth, h = container.clientHeight;
      renderer.setSize(w,h);
      camera.aspect = w/h;
      camera.updateProjectionMatrix();
    }

    function animate() {
      requestAnimationFrame(animate);
      renderer.render(scene, camera);
    }
  </script>
</head>

<body id="page-top">
  <div id="wrapper">
    <!-- Sidebar -->
    <ul class="navbar-nav bg-gradient-primary sidebar sidebar-dark accordion" id="accordionSidebar">
      <a class="sidebar-brand d-flex align-items-center justify-content-center" href="first_page.html">
        <div class="sidebar-brand-icon rotate-n-15"><i class="fas fa-laugh-wink"></i></div>
        <div class="sidebar-brand-text mx-3">SSR团队</div>
      </a>
      <hr class="sidebar-divider my-0">
      <li class="nav-item"><a class="nav-link" href="first_page.html"><i class="fas fa-fw fa-tachometer-alt"></i><span>首页展示</span></a></li>
      <hr class="sidebar-divider">
      <div class="sidebar-heading">数据图表</div>
      <li class="nav-item active"><a class="nav-link" href="text.html"><i class="fas fa-fw fa-chart-area"></i><span>图表</span></a></li>
      <li class="nav-item"><a class="nav-link" href="tables.html"><i class="fas fa-fw fa-table"></i><span>表格</span></a></li>
      <li class="nav-item"><a class="nav-link" href="XBox.html"><i class="fas fa-fw fa-cog"></i><span>手柄效果</span></a></li>
      <li class="nav-item"><a class="nav-link" href="camera.html"><i class="fas fa-fw fa-camera"></i><span>摄像头读取</span></a></li>
      <li class="nav-item"><a class="nav-link" href="model.html"><i class="fas fa-fw fa-wrench"></i><span>模型展示</span></a></li>
    </ul>
    <!-- End Sidebar -->

    <div id="content-wrapper" class="d-flex flex-column">
      <div id="content">
        <!-- Topbar -->
        <nav class="navbar navbar-expand navbar-light bg-white topbar mb-4 static-top shadow">
          <button id="sidebarToggleTop" class="btn btn-link d-md-none rounded-circle mr-3"><i class="fa fa-bars"></i></button>
          <ul class="navbar-nav ml-auto">
            <li class="nav-item dropdown no-arrow">
              <a class="nav-link dropdown-toggle" href="#" id="userDropdown">
                <span class="mr-2 d-none d-lg-inline text-gray-600 small">SSR团队研发</span>
                <img class="img-profile rounded-circle" src="img/picture.png">
              </a>
            </li>
          </ul>
        </nav>

        <div class="container-fluid">
          <h1 class="h3 mb-4 text-gray-800">各项数值展示</h1>
          <!-- Chart.js 图表 -->
          <div class="row">
            <!-- Area Chart -->
            <div class="col-xl-8 col-lg-7">
              <div class="card shadow mb-4">
                <div class="card-header"><h6 class="m-0 font-weight-bold text-primary">水下温度</h6></div>
                <div class="card-body"><div class="chart-area"><canvas id="myAreaChart"></canvas></div></div>
              </div>
            </div>
            <!-- Pie Chart -->
            <div class="col-xl-4 col-lg-5">
              <div class="card shadow mb-4">
                <div class="card-header"><h6 class="m-0 font-weight-bold text-primary">Revenue Sources</h6></div>
                <div class="card-body">
                  <div class="chart-pie pt-4 pb-2"><canvas id="myPieChart"></canvas></div>
                  <div class="mt-4 text-center small">
                    <span class="mr-2"><i class="fas fa-circle text-primary"></i> Direct</span>
                    <span class="mr-2"><i class="fas fa-circle text-success"></i> Social</span>
                    <span class="mr-2"><i class="fas fa-circle text-info"></i> Referral</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <!-- /.container-fluid -->

      </div>
      <!-- End of Main Content -->

      <!-- Footer -->
      <footer class="sticky-footer bg-white">
        <div class="container my-auto"><div class="copyright text-center my-auto"><span>Copyright &copy; Your Website 2021</span></div></div>
      </footer>
    </div>
    <!-- End of Content Wrapper -->
  </div>
  <!-- End of Page Wrapper -->

  <!-- Scroll to Top & Logout Modal omitted for brevity -->

  <!-- Core scripts -->
  <script src="vendor/jquery/jquery.min.js"></script>
  <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="vendor/jquery-easing/jquery.easing.min.js"></script>
  <script src="js/sb-admin-2.min.js"></script>

  <!-- Chart.js 初始化 -->
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // Area Chart 示例
      const ctxA = document.getElementById('myAreaChart').getContext('2d');
      new Chart(ctxA, {
        type: 'line',
        data: {
          labels: ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'],
          datasets: [{
            label: '水下温度',
            data: [15,16,18,20,22,24,26,28,27,25,23,20],
            borderColor: 'rgba(75,192,192,1)',
            tension: 0.4,
            fill: false
          }]
        },
        options: { scales: { y: { beginAtZero: true } } }
      });

      // Pie Chart 示例
      const ctxP = document.getElementById('myPieChart').getContext('2d');
      new Chart(ctxP, {
        type: 'pie',
        data: {
          labels: ['储蓄','支出','投资'],
          datasets: [{
            data: [5000,3000,2000],
            backgroundColor: ['#FF6384','#36A2EB','#FFCE56']
          }]
        }
      });
    });
  </script>
</body>
</html>
