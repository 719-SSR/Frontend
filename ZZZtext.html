<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>SB Admin 2 - Camera Stream</title>
  <!-- SB Admin 2 样式及字体 -->
  <link href="../../vendor/fontawesome-free/css/all.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Nunito:200,300,400,600,700,800,900" rel="stylesheet">
  <link href="../../css/sb-admin-2.min.css" rel="stylesheet">
</head>

<body id="page-top">
  <div id="wrapper">
    <!-- （侧边栏略，与原一致） -->
    
    <div id="content-wrapper" class="d-flex flex-column">
      <div id="content">
        <!-- Topbar 略 -->
        
        <!-- ====== Begin Page Content ====== -->
        <div class="container-fluid">
          <div class="row">
            <!-- RTSP 播放区 -->
            <div class="col-md-6 mb-4">
              <h5>RTSP 实时流</h5>
              <video id="rtspPlayer"
                     controls autoplay muted loop
                     style="width: 100%; background: black;">
                您的浏览器不支持 video 标签
              </video>
            </div>
            
            <!-- WebRTC 播放区 -->
            <div class="col-md-6 mb-4">
              <h5>WebRTC 实时流</h5>
              <video id="webrtcPlayer"
                     autoplay playsinline
                     style="width: 100%; background: black;">
              </video>
            </div>
          </div>
        </div>
        <!-- ====== End Page Content ====== -->
        
      </div>
    </div>
  </div>

  <!-- RTSP 播放库 -->
  <script src="https://cdn.jsdelivr.net/npm/rtsp-relay/browser/rtsp-relay.min.js"></script>
  <!-- WebRTC 兼容层 -->
  <script src="https://webrtc.github.io/adapter/adapter-latest.js"></script>
  
  <script>
  (async () => {
    // —— 1. RTSP 播放 ——  
    window.RTSPRelay.startPlayer({
      url: 'rtsp://localhost:8554/yourStream',
      element: document.getElementById('rtspPlayer'),
      protocol: 'tcp'
    });

    // —— 2. WebRTC 播放 ——  
    const pc = new RTCPeerConnection({
      iceServers: [{ urls: 'stun:stun.l.google.com:19302' }]
    });
    const videoEl = document.getElementById('webrtcPlayer');

    pc.ontrack = ({ streams }) => {
      videoEl.srcObject = streams[0];
    };

    const ws = new WebSocket('ws://localhost:8889');
    ws.onmessage = async ({ data }) => {
      const msg = JSON.parse(data);
      if (msg.sdp) {
        await pc.setRemoteDescription(msg.sdp);
        if (msg.sdp.type === 'offer') {
          const answer = await pc.createAnswer();
          await pc.setLocalDescription(answer);
          ws.send(JSON.stringify({ sdp: pc.localDescription }));
        }
      }
      else if (msg.ice) {
        await pc.addIceCandidate(msg.ice);
      }
    };

    pc.onicecandidate = ({ candidate }) => {
      if (candidate) ws.send(JSON.stringify({ ice: candidate }));
    };
  })();
  </script>
</body>
</html>
